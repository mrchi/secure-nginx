A secure Nginx configuration example for HTTPS website, generated by https://nginxconfig.io/

The HTTPS certificate is provided by [Let's Encrypt](https://letsencrypt.org/) using [certbot](https://certbot.eff.org/).

You may need to use `sudo` to run the following commands.

# How to use

## Update Nginx configurations

Clone this repo
```
git clone https://github.com/mrchi/secure-nginx.git
```

Copy files to `/etc/nginx`, just overwrite existing files
```
cp -R secure-nginx/nginx/* /etc/nginx
```

Create your own site conf file from `subdomain.example.com.conf` example, you need to change "server_name" and specific proxy rules in "server" part. Then make a soft link in `sites-enabled` directory.

## Apply for HTTPS certificate

Comment HTTPS server part in site conf file, then reload Nginx
```
nginx -t && nginx -s reload
```

Make directory for Certbot webroot validation
```
mkdir -p /var/www/_letsencrypt
chown www-data /var/www/_letsencrypt
```

Follow [certbot instruction](https://certbot.eff.org/instructions) to install certbot on your system.

Apply HTTPS certificate
```
certbot certonly --webroot -d YOUR_DOMAIN --email YOUR_EMAIL -w /var/www/_letsencrypt -n --agree-tos --force-renewal
```

Uncomment HTTPS server part in site conf file, and reload Nginx
```
nginx -t && nginx -s reload
```

Now you can access your site by HTTPS, enjoy it!

# One more step

Configure Certbot to reload NGINX after success renew
```
echo -e '#!/bin/bash\nnginx -t && nginx -s reload' | tee /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh
chmod a+x /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh
```
